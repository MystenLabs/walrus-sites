name: Build the server-portal docker image and publish it on dockerhub
run-name: Publish server-portal docker image for ${{ inputs.tag || github.ref_name }} release

on:
  release:
    types: created
  workflow_dispatch:
    inputs:
      tag:
        description: The server-portal tag (e.g. mainnet-v1.0.0). Defaults to the selected branch/tag.
        type: string
        required: false
concurrency: ${{ github.workflow }}-${{ inputs.tag || github.ref }}
jobs:
  release-build:
    name: Build & Publish Binaries
    timeout-minutes: 30
    runs-on: ubuntu-latest
    permissions:
      contents: read
      actions: write
    steps:
      - name: Dispatch Walrus Sites Portal To Dockerhub in MystenLabs/sui-operations
        uses: peter-evans/repository-dispatch@ff45666b9427631e3450c54a1bcbee4d9ff4d7c0 # pin@v3.0.0
        with:
          repository: MystenLabs/sui-operations
          token: ${{ secrets.SUI_OPS_DISPATCH_TOKEN }}
          event-type: walrus-sites-portal-to-dockerhub
          client-payload: '{"tag": "${{ inputs.tag || github.ref_name }}"}'
